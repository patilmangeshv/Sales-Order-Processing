<ion-header [translucent]="true">
    <ion-toolbar>
        <ion-title>
            Selected items [{{recordCountSelected}}/{{recordCount}}]
        </ion-title>

        <ion-buttons slot="end">
            <ion-button (click)="saveClicked()">
                <ion-icon slot="icon-only" color="secondary" name="save-outline"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content>
    <ion-searchbar color="light" #search animated autocomplete="on" placeholder="Search by name or description"
        (ionInput)="filterDataOnSearchText($event)"></ion-searchbar>
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
        <ion-refresher-content pullingIcon="arrow-down" pullingText="Pull to refresh" refreshingSpinner="circles"
            refreshingText="Refreshing...">
        </ion-refresher-content>
    </ion-refresher>

    <div class="alert alert-success">
        <ion-label>Select items to order. Quantity can be changed on order screen.</ion-label>
    </div>

    <!-- Skeleton Text -->
    <ng-container *ngIf="!isDataLoaded">
        <ion-card *ngFor="let item of [].constructor(10)">
            <ion-item>
                <ion-thumbnail slot="start">
                    <ion-skeleton-text animated></ion-skeleton-text>
                </ion-thumbnail>
                <ion-label>
                    <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text>
                </ion-label>
            </ion-item>

            <ion-card-content>
                <ion-row>
                    <ion-col size="6">
                        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                    </ion-col>
                    <ion-col size="6">
                        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                    </ion-col>
                </ion-row>

                <ion-row>
                    <ion-col size="6">
                        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                    </ion-col>
                </ion-row>

                <ion-row>
                    <ion-col>
                        <ion-skeleton-text animated style="width: 100%"></ion-skeleton-text>
                    </ion-col>
                </ion-row>

            </ion-card-content>
        </ion-card>
    </ng-container>

    <ng-container *ngIf="isDataLoaded">
        <ng-container *ngIf="itemList.length<=0">
            <ion-card>
                <ion-item>
                    <ion-label color="secondary">
                        There are no items present.
                    </ion-label>
                </ion-item>
            </ion-card>
        </ng-container>

        <ng-container *ngIf="itemList.length>0">
            <ion-card *ngFor="let item of itemList">
                <ion-item [disabled]="item.stockMaintained && item.balanceQty<=0">
                    <!-- <ion-item (click)="itemSelected(item)" [disabled]="item.stockMaintained && item.balanceQty<=0"> -->
                    <ion-thumbnail slot="start" size="small">
                        <img *ngIf="item.itemImageThumURL" [alt]="item.itemName" [src]="item.itemImageThumURL">
                        <img *ngIf="!item.itemImageThumURL" [alt]="item.itemName"
                            src="../../../assets//icon//camera.png">
                    </ion-thumbnail>

                    <ion-label class="ion-text-wrap">{{item.itemName}} <br> {{item.externalCode1}}</ion-label>
                    <ion-icon name="heart" *ngIf="item.isFavorite" size="large" color="secondary">
                    </ion-icon>

                    <!-- <ion-icon name="checkmark-circle-outline" *ngIf="item.isItemSelected" color="secondary" slot="end">
                </ion-icon>
                <ion-icon name="ellipse-outline" *ngIf="!item.isItemSelected" color="secondary" slot="end">
                </ion-icon> -->
                </ion-item>

                <ion-card-content>
                    <!-- <ion-card-content (click)="itemSelected(item)"> -->
                    <ion-row>
                        <ion-col size="6">
                            <!-- Show mrp as strikethrough(</del>) if it is greater than wholesaleBillPrice in red color -->
                            <!-- Rs symbol &#8377; -->
                            <!-- mrp -->

                            <!-- if isRetailCustomer -->
                            <ng-container *ngIf="isRetailCustomer; else showWholesalePrices">
                                <ion-label *ngIf="item.mrp>item.sellingPrice" class="font-small">
                                    <del>MRP: &#8377; {{item.mrp | number:'1.2-4'}}</del>
                                    <ion-text color="danger"> &#8377; {{item.sellingPrice | number:'1.2-4'}}
                                    </ion-text>
                                </ion-label>

                                <!-- sellingPrice -->
                                <ion-label *ngIf="item.mrp<=item.sellingPrice" class="font-small">
                                    MRP: &#8377; {{item.mrp | number:'1.2-4'}}
                                </ion-label>
                            </ng-container>
                            <!-- else -->
                            <ng-template #showWholesalePrices>
                                <ion-label *ngIf="item.mrp>item.wholesaleBillPrice" class="font-small">
                                    <del>MRP: &#8377; {{item.mrp | number:'1.2-4'}}</del>
                                    <ion-text color="danger"> &#8377; {{item.wholesaleBillPrice | number:'1.2-4'}}
                                    </ion-text>
                                </ion-label>

                                <!-- wholesaleBillPrice -->
                                <ion-label *ngIf="item.mrp<=item.wholesaleBillPrice" class="font-small">
                                    MRP: &#8377; {{item.mrp | number:'1.2-4'}}
                                </ion-label>
                            </ng-template>

                            <!-- 
                            NOTE: Below block should be consider whenever we will have identification of wholesaler or retailer customer logic
                            mrp
                            <ion-label *ngIf="item.mrp>item.sellingPrice" class="font-small">
                                <del>MRP: &#8377; {{item.mrp | number:'1.2-4'}}</del>
                                <ion-text color="danger"> &#8377; {{item.sellingPrice | number:'1.2-4'}}</ion-text>
                            </ion-label>

                            sellingPrice 
                            <ion-label *ngIf="item.mrp<=item.sellingPrice" class="font-small">
                                MRP: &#8377; {{item.sellingPrice | number:'1.2-4'}}
                            </ion-label>
                            -->
                        </ion-col>
                        <ion-col size="6">
                            <ion-label class="font-small">{{item.packageSize}} {{item.packageUnit}}
                            </ion-label>
                        </ion-col>
                    </ion-row>

                    <ion-row>
                        <ion-col size="6">
                            <!--     <ng-container
                                *ngIf="item.wholesalePriceWithGST && item.wholesalePriceWithGST>0; else showWithoutGST">
                                !--Wholesale price with GST--
                                <ion-label class="font-small">&#8377; {{item.wholesalePriceWithGST | number:'1.2-4'}}
                                </ion-label>
                            </ng-container>

                            <ng-template #showWithoutGST>
                                !-- Wholesale price without GST--
                                <ion-label class="font-small">&#8377; {{item.wholesalePrice | number:'1.2-4'}}
                                </ion-label>
                            </ng-template> -->
                        </ion-col>

                        <!-- quantity -->
                        <ion-col>
                            <ion-row class="center-row">
                                <ion-icon name="remove-circle-outline" size="large" color="secondary"
                                    (click)="itemDecreaseQty(item)"></ion-icon>
                                <ion-text class="counter-value">{{item.quantity | number:'1.0-1'}}</ion-text>
                                <ion-icon name="add-circle-outline" size="large" color="secondary"
                                    (click)="itemIncreaseQty(item)"></ion-icon>
                            </ion-row>
                        </ion-col>
                    </ion-row>

                    <ion-row>
                        <!-- Balance Quantity logic -->
                        <ion-col size="6">
                            <ion-text
                                *ngIf="item.stockMaintained && item.balanceQty<item.stockMinimumQty && item.balanceQty>0"
                                color="danger" class="font-small">Only
                                {{item.balanceQty}} left.
                            </ion-text>
                            <ion-text *ngIf="item.stockMaintained && item.balanceQty<=0" color="danger"
                                class="font-small">
                                Currently unavailable.
                            </ion-text>
                            <ion-text *ngIf="!item.stockMaintained || item.balanceQty>item.stockMinimumQty"
                                color="success" class="font-small">In stock.
                            </ion-text>
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col>
                            <div [innerHTML]="item.itemDescription"></div>
                        </ion-col>
                    </ion-row>
                </ion-card-content>
            </ion-card>
        </ng-container>
    </ng-container>
</ion-content>